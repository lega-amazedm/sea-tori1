<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî Sea Tori</title>
<link rel="stylesheet" href="css/style.css" />
</head>
<body>
<header class="header">
  <div class="container">
    <div class="logo">Sea Tori</div>
    <nav class="nav" id="main-nav">
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="menu.html">–ú–µ–Ω—é</a>
      <a href="cart.html">–ö–æ—Ä–∑–∏–Ω–∞</a>
      <a href="profile.html" class="active" id="profile-link">–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>
    <div class="burger" id="burger-menu">
      <span></span><span></span><span></span>
    </div>
  </div>
</header>
<main class="main">
  <h2 class="page-title">–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <form class="profile-info" id="profile-form">
    <div class="form-group">
      <label for="profile-name">–ò–º—è</label>
      <input type="text" id="profile-name" name="name" required>
    </div>
    <div class="form-group">
      <label for="profile-phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
      <input type="tel" id="profile-phone" name="phone" required>
    </div>
    <div class="form-group">
      <label for="profile-address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
      <input type="text" id="profile-address" name="address" required>
    </div>
    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </form>
  <div class="order-history" id="order-history">
    <h3>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
    <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
  </div>
  <button class="btn btn-secondary" id="logout-btn">–í—ã–π—Ç–∏</button>
  <div id="admin-panel-btn-wrap"></div>
</main>
<footer class="footer new-footer">
  <div class="container">
    <div class="footer-main">
      <div class="footer-logo-block">
        <div class="footer-logo">Sea Tori <span style='font-size:1.3em;'>üç£</span></div>
        <div class="footer-desc">–ö–∞—Ñ–µ –∏ —Å—É—à–∏-–±–∞—Ä –≤ —è–ø–æ–Ω—Å–∫–æ–º —Å—Ç–∏–ª–µ.<br>–°–≤–µ–∂–∏–µ –±–ª—é–¥–∞, —É—é—Ç–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞.</div>
      </div>
      <div class="footer-contacts-block">
        <div class="footer-contacts-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
        <div class="footer-contacts-list">
          <span>+7 999 888 77 66</span>
          <span>seatori@mail.ru</span>
          <span>–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –Ø–ø–æ–Ω—Å–∫–∞—è, 7</span>
          <span>–ü–Ω-–í—Å: 11:00‚Äì23:00</span>
        </div>
      </div>
      <div class="footer-socials-block">
        <div class="footer-contacts-title">–ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</div>
        <div class="footer-socials">
          <a href="https://t.me/sea_tori" aria-label="Telegram" target="_blank"><img src="img/telegram.svg" alt="Telegram" class="footer-icon"></a>
          <a href="https://instagram.com/sea_tori" aria-label="Instagram" target="_blank"><img src="img/instagram.svg" alt="Instagram" class="footer-icon"></a>
          <a href="https://vk.com/sea_tori" aria-label="VK" target="_blank"><img src="img/vk.svg" alt="VK" class="footer-icon"></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <span>¬© 2024 Sea Tori. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</span>
      <span>–°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∫ –Ø–ø–æ–Ω–∏–∏ <span style='font-size:1.1em;'>‚õ©Ô∏è</span></span>
    </div>
  </div>
</footer>
<script>
  if (!localStorage.getItem('currentUser')) window.location.href = 'login.html';
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
      logoutBtn.onclick = function() {
        localStorage.removeItem('currentUser');
        window.location.href = 'login.html';
      };
    }
    // –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function getOrders() {
      try { return JSON.parse(localStorage.getItem('orders')||'[]'); } catch(e){ return []; }
    }
    function renderUserOrders() {
      const user = JSON.parse(localStorage.getItem('currentUser')||'null');
      if (!user) return;
      const orders = getOrders();
      // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ –ª–æ–≥–∏–Ω—É (—Å—Ç—Ä–æ–≥–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤)
      const userPhone = (user.phone||'').replace(/\D/g,'');
      const userLogin = (user.login||'').trim();
      const userOrders = orders.filter(o => {
        const oPhone = (o.phone||'').replace(/\D/g,'');
        const oLogin = (o.login||'').trim();
        return (userPhone && oPhone && oPhone === userPhone) || (userLogin && oLogin && oLogin === userLogin);
      });
      const wrap = document.getElementById('order-history');
      let html = '<h3>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>';
      if (!userOrders.length) {
        html += '<div style="color:#bbb;text-align:center;margin:18px 0;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤ (user: '+JSON.stringify(user)+')</div>';
      } else {
        userOrders.sort((a,b)=>b.date.localeCompare(a.date));
        html += '<div style="display:flex;flex-direction:column;gap:18px;">';
        userOrders.forEach(order => {
          const status = order.status||'–ù–æ–≤—ã–π';
          const statusColor = status==='–í—ã–ø–æ–ª–Ω–µ–Ω–æ' ? '#b80000' : '#1a7a1a';
          const statusBg = status==='–í—ã–ø–æ–ª–Ω–µ–Ω–æ' ? '#ffd6d6' : '#d4f7d4';
          html += `<div style="background:#fff;border-radius:14px;box-shadow:0 2px 10px #0001;padding:16px 14px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
              <span style="font-size:1.08em;font-weight:600;">${order.date ? order.date.replace('T',' ').slice(0,16) : ''}</span>
              <span style="padding:4px 14px;border-radius:8px;font-weight:700;background:${statusBg};color:${statusColor};">${status}</span>
            </div>
            <div style="font-size:1em;margin-bottom:6px;">${(order.items||[]).map(i=>`${i.name} x${i.count||1}`).join(', ')}</div>
            <div style="font-size:1.08em;font-weight:600;">–°—É–º–º–∞: ${order.total} ‚ÇΩ</div>
          </div>`;
        });
        html += '</div>';
      }
      wrap.innerHTML = html;
    }
    renderUserOrders();
  });
</script>
<script src="js/profile.js"></script>
</body>
</html> 