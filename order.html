<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Äî Sea Tori</title>
<link rel="stylesheet" href="css/style.css" />
</head>
<body>
<header class="header">
  <div class="container">
    <div class="logo">Sea Tori</div>
    <nav class="nav" id="main-nav">
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="menu.html">–ú–µ–Ω—é</a>
      <a href="cart.html">–ö–æ—Ä–∑–∏–Ω–∞</a>
      <a href="profile.html" id="profile-link">–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>
    <div class="burger" id="burger-menu">
      <span></span><span></span><span></span>
    </div>
  </div>
</header>
<main class="main">
  <h2 class="page-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
  <form class="order-form" id="order-form">
    <div class="form-group">
      <label for="order-name">–ò–º—è</label>
      <input type="text" id="order-name" name="name" required autocomplete="name">
    </div>
    <div class="form-group">
      <label for="order-phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
      <input type="tel" id="order-phone" name="phone" required autocomplete="tel">
    </div>
    <div class="form-group">
      <label for="order-address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
      <input type="text" id="order-address" name="address" required autocomplete="street-address">
    </div>
    <div class="form-group">
      <label for="order-payment">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</label>
      <select id="order-payment" name="payment" required>
        <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ –∫—É—Ä—å–µ—Ä—É</option>
        <option value="transfer">–ü–µ—Ä–µ–≤–æ–¥–æ–º –∫—É—Ä—å–µ—Ä—É</option>
      </select>
    </div>
    <div class="order-summary">
      <span>–ò—Ç–æ–≥–æ: <span id="order-total">0 ‚ÇΩ</span></span>
    </div>
    <button type="submit" class="btn btn-primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </form>
  <div id="order-error" style="color:#ff4b4b;text-align:center;margin-top:12px;min-height:22px;"></div>
  <div id="order-success" class="order-success" style="display:none;">
    <h3>–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!</h3>
    <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</p>
    <a href="menu.html" class="btn">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</a>
  </div>
</main>
<footer class="footer new-footer">
  <div class="container">
    <div class="footer-main">
      <div class="footer-logo-block">
        <div class="footer-logo">Sea Tori <span style='font-size:1.3em;'>üç£</span></div>
        <div class="footer-desc">–ö–∞—Ñ–µ –∏ —Å—É—à–∏-–±–∞—Ä –≤ —è–ø–æ–Ω—Å–∫–æ–º —Å—Ç–∏–ª–µ.<br>–°–≤–µ–∂–∏–µ –±–ª—é–¥–∞, —É—é—Ç–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞.</div>
      </div>
      <div class="footer-contacts-block">
        <div class="footer-contacts-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
        <div class="footer-contacts-list">
          <span>+7 999 888 77 66</span>
          <span>seatori@mail.ru</span>
          <span>–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –Ø–ø–æ–Ω—Å–∫–∞—è, 7</span>
          <span>–ü–Ω-–í—Å: 11:00‚Äì23:00</span>
        </div>
      </div>
      <div class="footer-socials-block">
        <div class="footer-contacts-title">–ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</div>
        <div class="footer-socials">
          <a href="https://t.me/sea_tori" aria-label="Telegram" target="_blank"><img src="img/telegram.svg" alt="Telegram" class="footer-icon"></a>
          <a href="https://instagram.com/sea_tori" aria-label="Instagram" target="_blank"><img src="img/instagram.svg" alt="Instagram" class="footer-icon"></a>
          <a href="https://vk.com/sea_tori" aria-label="VK" target="_blank"><img src="img/vk.svg" alt="VK" class="footer-icon"></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <span>¬© 2024 Sea Tori. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</span>
      <span>–°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∫ –Ø–ø–æ–Ω–∏–∏ <span style='font-size:1.1em;'>‚õ©Ô∏è</span></span>
    </div>
  </div>
</footer>
<script>
  if (!localStorage.getItem('currentUser')) window.location.href = 'login.html';

  function getCart() {
    try { return JSON.parse(localStorage.getItem('cart') || '[]'); } catch (e) { return []; }
  }
  function setCart(cart) { localStorage.setItem('cart', JSON.stringify(cart)); }
  function getDelivery() {
    try { return JSON.parse(localStorage.getItem('delivery') || 'null'); } catch (e) { return null; }
  }
  function renderOrderTotal() {
    const cart = getCart();
    const delivery = getDelivery();
    let total = 0;
    cart.forEach(item => { total += (item.price * (item.count || 1)); });
    let deliveryText = '';
    if (delivery) { total += delivery.price; deliveryText = ` + –¥–æ—Å—Ç–∞–≤–∫–∞: ${delivery.name} (${delivery.price} ‚ÇΩ)`; }
    else { deliveryText = '<span style="color:#e64b4b;font-size:0.95em;"> (–≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ—Å—Ç–∞–≤–∫—É –≤ –º–µ–Ω—é)</span>'; }
    document.getElementById('order-total').innerHTML = total + ' ‚ÇΩ' + deliveryText;
  }
  document.addEventListener('DOMContentLoaded', renderOrderTotal);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('order-form');
    if (!form) return;
    form.onsubmit = function(e) {
      e.preventDefault();
      const name = document.getElementById('order-name').value.trim();
      const phone = document.getElementById('order-phone').value.trim();
      const address = document.getElementById('order-address').value.trim();
      const payment = document.getElementById('order-payment').value;
      const cart = getCart();
      const delivery = getDelivery();
      if (!delivery) {
        document.getElementById('order-error').textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–æ—Å—Ç–∞–≤–∫—É –≤ –º–µ–Ω—é!';
        return;
      }
      if (cart.length === 0) {
        document.getElementById('order-error').textContent = '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!';
        return;
      }
      let total = cart.reduce((sum, item) => sum + item.price * (item.count || 1), 0) + delivery.price;
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑
      const order = {
        date: new Date().toISOString(),
        name, phone, address, payment,
        items: cart,
        delivery,
        total
      };
      let orders = [];
      try { orders = JSON.parse(localStorage.getItem('orders') || '[]'); } catch (e) {}
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));
      setCart([]);
      window.location.href = 'thankyou.html';
    };
  });
</script>
<script src="js/db.js"></script>
<script src="js/order.js"></script>
<script>
  window.showThankYou = function() {
    window.location.href = 'thankyou.html';
  }
</script>
</body>
</html>